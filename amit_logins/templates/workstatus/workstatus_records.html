{% extends 'logins/base.html' %}
{% block content %}
<style>
    table th, table td {
    white-space: normal !important; /* allow wrapping */
    word-wrap: break-word;
    overflow-wrap: break-word;
}
</style>
<div class="container-fluid mt-4">
    <h3 style="font-weight: 900;" class="text-center mb-4 text-uppercase">{{ branch }} - {{ department }}</h3>
<center>
<form method="GET" class="mb-3 d-flex justify-content-center gap-2 flex-wrap">
    <!-- Search input -->
    <input type="text" name="q" class="form-control w-25" 
           placeholder="Search by id, work code, or username" 
           value="{{ request.GET.q }}">

    <!-- From Date -->
     <label class="mt-2" style="font-weight: 900;">FROM:</label>
    <input type="date" name="from_date" class="form-control w-auto"
           value="{{ request.GET.from_date }}">

    <!-- To Date -->
     <label class="mt-2" style="font-weight: 900;">TO:</label>
    <input type="date" name="to_date" class="form-control w-auto"
           value="{{ request.GET.to_date }}">

    <button type="submit" class="btn btn-primary">FILTER</button>
</form>
<!-- <form method="GET" class="mb-3 d-flex justify-content-center gap-1 flex-wrap">
    <input type="text" name="q" class="form-control w-25" 
           placeholder="Search by id or work code" 
           value="{{ request.GET.q }}">

    <input type="date" name="date" class="form-control w-auto"
           value="{{ request.GET.date }}">

    <button type="submit" class="btn btn-primary">FILTER</button>
</form> -->
</center>
    <table class="table table-bordered table-rounded text-center mt-4" style="table-layout: fixed; width: 100%;">
        <thead class="table-light align-middle">
            <tr>
                <th style="width: 5%;">S.NO</th>
                <th style="width: 10%;">DATE</th>
                <th style="width: 10%;">USER</th>
                <th style="width: 75%;">WORK STATUS</th>
            </tr>
        </thead>
        <tbody>
            {% for group in groups %}
            <tr>
                <td class="align-middle">{{ group.S_NO }}</td>
                <td class="align-middle">{{ group.DATE|date:"d/m/Y" }}</td>
                <td class="align-middle">{{ group.user.username }}<br> ({{group.user.employee_name}})</td>
                <td>
                    <table class="table table-sm table-bordered table-rounded mb-0" style="table-layout: fixed; width: 100%;">
                        <thead class="table-light align-middle text-center">
                            <tr>
                                <th style="width: 20%;">WORK CODE</th>
                                <th style="width: 45%;">WORK DETAILS</th>
                                <th style="width: 10%;">STARTING DATE</th>
                                <th style="width: 10%;">ENDING DATE</th>
                                <th style="width: 15%;">STATUS</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for status in group.statuses.all %}
                            <tr>
                                <td class="text-center align-middle">{{ status.WORK_CODE }}</td>
                                <td class="align-middle text-start">
                                    <pre style="white-space: pre-wrap; word-wrap: break-word; font-family: 'Inter', sans-serif; margin-bottom: 0;">
{{ status.WORK_DETAILS }}</pre>
                                </td>
                                <td class="text-center align-middle">{{ status.STARTING_DATE|date:"d/m/Y"|default:"-" }}</td>
                                <td class="text-center align-middle">{{ status.ENDING_DATE|date:"d/m/Y"|default:"-" }}</td>
                                <td class="text-center align-middle">{{ status.WORK_STATUS }}</td>
                            </tr>
                            {% empty %}
                            <tr><td colspan="5" class="text-center">No Work Entries</td></tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </td>
            </tr>
            {% empty %}
            <tr><td colspan="4" class="text-center">No Records Found</td></tr>
            {% endfor %}
        </tbody>
    </table>
</div>
{% endblock %}
